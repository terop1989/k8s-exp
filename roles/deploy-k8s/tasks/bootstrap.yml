- name: Remove swapfile from /etc/fstab
  mount:
    name: none
    fstype: swap
    state: absent

- name: Disable swap
  command: swapoff -a

- name: Disable Firewall
  ufw:
    state: disabled

- name: Copy containerd.conf to Remote Hosts
  copy:
    src: containerd.conf
    dest: /etc/modules-load.d/containerd.conf

- name: Apply Kernel Modules
  command:
    cmd: "{{ item }}"
  loop:
    - "modprobe overlay"
    - "modprobe br_netfilter"

- name: Copy cri.conf file to Remote Hosts
  copy:
    src: cri.conf
    dest: /etc/sysctl.d/cri.conf

- name: Apply cri.conf
  command:
    cmd: sysctl --system
